"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(t,a,r,l){return new(r||(r=Promise))(function(n,e){function i(t){try{s(l.next(t))}catch(t){e(t)}}function o(t){try{s(l.throw(t))}catch(t){e(t)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(i,o)}s((l=l.apply(t,a||[])).next())})},__generator=this&&this.__generator||function(n,i){var o,s,a,r,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function t(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;r&&e[r=0]&&(l=0),l;)try{if(o=1,s&&(a=2&e[0]?s.return:e[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,e[1])).done)return a;switch(s=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return l.label++,{value:e[1],done:!1};case 5:l.label++,s=e[1],e=[0];continue;case 7:e=l.ops.pop(),l.trys.pop();continue;default:if(!(a=0<(a=l.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){l=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){l.label=e[1];break}if(6===e[0]&&l.label<a[1]){l.label=a[1],a=e;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(e);break}a[2]&&l.ops.pop(),l.trys.pop();continue}e=i.call(n,l)}catch(t){e=[6,t],s=0}finally{o=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},Aidabot=function(){function t(){this.languageData={en:{inputMessage:"Type a message here..."},ja:{inputMessage:"お困りを入力してください"},vi:{inputMessage:"Nhập tin nhắn vào đây..."}},this.client_id="",this.chat_history_id="",this.bot_name="AIdaBOT",this.base_url="https://app.aidabot.io",this.assets_url="https://www.aidabot.io/assets",this.lang="vi",this.filesLength=0,this.hints=[],this.greetings=[],this.settings={},this.isCollectInfo=!1,this.isListening=!1,this.voicesLoaded=!1,this.isSpeaking=!1,this.toggleOpen=!1,this.theme={headerBackground:"#111727",headerText:"#ffffff",botBackground:"#f2f2f2",botText:"#00000",userBackground:"#111727",userText:"#ffffff",messagesBackground:"#ffffff",footerBackground:"#ffffff",footerText:"#000000",toggleBackground:"#111727",toggleFill:"#ffffff",toggleStroke:"#ffffff",closeIconBackground:"#111727",closeIconFill:"#ffffff",closeIconStroke:"#ffffff",sendIconBackground:"#111727",sendIconFill:"#ffffff",sendIconStroke:"#ffffff"},this._bot_logo=this.botIcon(),this._bot_name=this.botName(),this._bot_ui=document.createElement("div"),this._bot_ui.classList.add("aidabot","aidabot-animate-fade-in-up"),this._chat_header=document.createElement("div"),this._chat_header.classList.add("aidabot-header"),this._chat_messages=document.createElement("ul"),this._chat_messages.classList.add("aidabot-messages"),this._chat_footer=document.createElement("div"),this._chat_footer.classList.add("aidabot-footer"),this._send_btn=document.createElement("button"),this._send_btn.classList.add("btn-send"),this._send_btn.innerHTML=this.svgSendIcon(),this._send_btn.style.backgroundColor=this.theme.sendIconBackground,this._send_btn.addEventListener("click",this.sendQA.bind(this)),this._send_btn.style.visibility="visible",this._voice_btn=document.createElement("button"),this._voice_btn.classList.add("btn-voice"),this._voice_btn.innerHTML=this.svgMicIcon(),this._voice_btn.style.backgroundColor=this.theme.sendIconBackground,this._voice_btn.addEventListener("click",this.handleRecognition.bind(this)),this._voice_btn.style.visibility="visible",this._input=document.createElement("textarea"),this._input.setAttribute("type","text"),this._input.setAttribute("required","true"),this._input.addEventListener("keydown",this.handleKeyDown.bind(this)),this._chat_footer.appendChild(this._input),this._chat_footer.appendChild(this._voice_btn),this._chat_footer.appendChild(this._send_btn),this._toggle_btn=document.createElement("button"),this._toggle_btn.classList.add("aidabot-btn-toggle"),this._toggle_btn.innerHTML=this.crispIcon(),this._toggle_btn.addEventListener("click",this.getToggleBtn.bind(this)),this._close_btn=document.createElement("button"),this._close_btn.classList.add("aidabot-btn-close"),this._close_btn.textContent="X",this.initVoiceRecognition()}return t.prototype.uuid=function(){var t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.substr(e.lastIndexOf("/")+1)},t.prototype.init=function(){var n,i,o,s;return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.initBotConfig(this.client_id)];case 1:return t.sent(),e=window.location.hostname,(!(null===(i=null===(n=this.settings)||void 0===n?void 0:n.allowed_domains)||void 0===i?void 0:i.length)||(null===(s=null===(o=this.settings)||void 0===o?void 0:o.allowed_domains)||void 0===s?void 0:s.includes(e)))&&this.initBotUI(),[2]}})})},t.prototype.handleKeyDown=function(t){13!==t.which||t.shiftKey||(t.preventDefault(),t.target.value&&this.sendQA(),t.target.value="")},t.prototype.closeIcon=function(){return'\n    <svg fill="none" stroke='.concat(this.theme.toggleStroke,' xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" class="aidabot-animate-fade-in-rotate-45deg">\n      <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round" />\n    </svg>\n    ')},t.prototype.crispIcon=function(){return"\n    <svg fill=".concat(this.theme.toggleFill," stroke=").concat(this.theme.toggleStroke,' viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="aidabot-animate-fade-in-rotate-45deg">\n      <path d="M20,16H15l-3,4L9,16H4a1,1,0,0,1-1-1V5A1,1,0,0,1,4,4H20a1,1,0,0,1,1,1V15A1,1,0,0,1,20,16Z" />\n    </svg>\n    ')},t.prototype.svgSendIcon=function(){return'\n    <svg class="send-icon" viewBox="0 0 24 24">\n      <path fill='.concat(this.theme.sendIconFill," stroke=").concat(this.theme.sendIconStroke,' d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>\n    </svg>\n    ')},t.prototype.svgMicIcon=function(){return'\n    <svg class="send-icon" id="voice-icon" viewBox="0 0 24 24">\n      <g id="mic-icon">\n        <path\n          d="M12 3a3 3 0 00-3 3v6a3 3 0 006 0V6a3 3 0 00-3-3zm7 7v2a7 7 0 01-14 0v-2h-2v2a9 9 0 0018 0v-2h-2zM12 1a5 5 0 015 5v6a5 5 0 11-10 0V6a5 5 0 015-5zm-1 18h2v2h-2v-2z"\n          fill="#ffffff"\n          stroke="#ffffff"\n          stroke-width="1.3"\n        >\n        </path>\n      </g>\n    </svg>'},t.prototype.svgMicOnIcon=function(){return'\n    <svg class="send-icon" id="voice-icon" viewBox="0 0 24 24">\n      <g id="mic-off-icon">\n        <g class="wave" fill="#ffffff">\n          <rect x="6" y="8" width="2" height="8">\n            <animate attributeName="height" values="8;16;8" dur="0.5s" repeatCount="indefinite" />\n            <animate attributeName="y" values="8;4;8" dur="0.5s" repeatCount="indefinite" />\n          </rect>\n          <rect x="11" y="6" width="2" height="12">\n            <animate attributeName="height" values="12;20;12" dur="0.5s" repeatCount="indefinite" />\n            <animate attributeName="y" values="6;2;6" dur="0.5s" repeatCount="indefinite" />\n          </rect>\n          <rect x="16" y="8" width="2" height="8">\n            <animate attributeName="height" values="8;16;8" dur="0.5s" repeatCount="indefinite" />\n            <animate attributeName="y" values="8;4;8" dur="0.5s" repeatCount="indefinite" />\n          </rect>\n        </g>\n      </g>\n    </svg>'},t.prototype.getToggleBtn=function(){this.toggleOpen=!this.toggleOpen,this.toggleOpen?(""==this.chat_history_id&&(this.chat_history_id=this.uuid()),this._bot_ui.style.display="block",this._toggle_btn.innerHTML="",this._toggle_btn.classList.add("open"),this._toggle_btn.innerHTML=this.closeIcon()):(this._bot_ui.style.display="none",this._toggle_btn.innerHTML="",this._toggle_btn.classList.remove("open"),this._toggle_btn.innerHTML=this.crispIcon())},t.prototype.botIcon=function(){var t=document.createElement("img");return t.src="https://static.aidabot.io/statics/images/favicon_48x48.png",t.classList.add("aidabot-logo"),t},t.prototype.botName=function(){var t=document.createElement("div");return t.textContent=this.bot_name,t.classList.add("aidabot-name"),t},t.prototype.changeLogo=function(t){this._bot_logo.src=t},t.prototype.changeName=function(t){this.bot_name=t,this._bot_name.textContent=t},t.prototype.initBotUI=function(){var n=this;this._chat_header.innerHTML='\n    <div class="aidabot-header-title" display="flex">\n      '.concat(this._bot_logo.outerHTML,"\n      ").concat(this._bot_name.outerHTML,"\n    </div>\n    "),this._chat_header.style.backgroundColor=this.theme.headerBackground,this._chat_header.style.color=this.theme.headerText,this._close_btn.addEventListener("click",this.getToggleBtn.bind(this)),this._chat_header.appendChild(this._close_btn),this._bot_ui.appendChild(this._chat_header),this._chat_messages.style.backgroundColor=this.theme.messagesBackground,this._bot_ui.appendChild(this._chat_messages),this._chat_footer.style.backgroundColor=this.theme.footerBackground,this._chat_footer.style.color=this.theme.footerText,this._bot_ui.style.display="none";var t=document.body;if(t.appendChild(this._bot_ui),t.appendChild(this._toggle_btn),this.filesLength){if(this.greetings.length)this.greetings.forEach(function(t){var e=n.createMessage(t.greeting_content,!0);n._chat_messages.appendChild(e)});else{var e="Xin chào, tôi là ".concat(this.bot_name,".\nTôi có thể giúp bạn giải đáp các vấn đề chuyên môn đã được chuẩn bị sẵn trong tài liệu."),i=this.createMessage(e,!0);this._chat_messages.appendChild(i)}if(this.isCollectInfo)if(null===localStorage.getItem(this.client_id)){var o=this.createMessage(this.getElementCollectInformation(),!0);this._chat_messages.appendChild(o),this.validateForm(o)}else this.initHintUI(this.hints);else{if(null===localStorage.getItem(this.client_id+"-customer")){var s=this.uuid();localStorage.setItem(this.client_id+"-customer",JSON.stringify({external_id:s,name:"Incognito",email:s+"@chat.aidabot.io",phone_number:null}))}this.initHintUI(this.hints)}}else{e="ja"===this.lang?"そのサービスは無効です。詳細についてはスタッフにお問い合わせください。":"vi"===this.lang?"Dịch vụ này không hợp lệ. Vui lòng liên hệ với nhân viên để biết thêm thông tin.":"This service is not valid. Please contact staff for more information.";(i=this.createMessage(e,!0)).classList.add("message-error"),this._chat_messages.appendChild(i)}},t.prototype.getConfig=function(){return{clientId:this.client_id,botName:this.bot_name}},t.prototype.getClientId=function(){return this.client_id},t.prototype.getBotName=function(){return this.bot_name},t.prototype.getBaseUrl=function(){return this.base_url},t.prototype.getAssetsUrl=function(){return this.assets_url},t.prototype.setConfig=function(t){var e,n;t.theme&&(this.theme=__assign(__assign({},{headerBackground:"#111727",headerText:"#ffffff",botBackground:"#f2f2f2",botText:"#00000",userBackground:"#111727",userText:"#ffffff",messagesBackground:"#ffffff",footerBackground:"#ffffff",footerText:"#000000",toggleBackground:"#111727",toggleFill:"#ffffff",toggleStroke:"#ffffff",closeIconBackground:"#ffffff",closeIconFill:"#111727",closeIconStroke:"#111727",sendIconBackground:"#ffffff",sendIconFill:"#111727",sendIconStroke:"#111727"}),t.theme),this._toggle_btn.style.backgroundColor=this.theme.toggleBackground),this.client_id=t.clientId,this.bot_name=null!==(e=t.botName)&&void 0!==e?e:this.bot_name,this._input.setAttribute("placeholder",null!==(n=t.placeholder)&&void 0!==n?n:this.languageData[this.lang].inputMessage)},t.prototype.setClientId=function(t){this.client_id=t},t.prototype.setBotName=function(t){this.bot_name=t},t.prototype.sendQARequest=function(t){var e=document.getElementById("aidabot-hints-embed");e&&(e.style.display="none",e.hidden=!0);var n=this.createMessage(t,!1);this._chat_messages.appendChild(n);var i=t;this._input.value="",this.scrollToBottom();var o=this.createTypingMessage();this._chat_messages.appendChild(o),this.scrollToBottom();var s=!!this.isListening;this.getResponse(o,i,s)},t.prototype.sendQA=function(){""!==this._input.value.trim()&&this.sendQARequest(this._input.value)},t.prototype.createMessage=function(t,e){var n=e?"message-bot":"message-user",i=document.createElement("li");i.classList.add("message",n);var o=document.createElement("p");o.style.backgroundColor=this.theme.botBackground,o.style.color=this.theme.botText,e||(o.style.backgroundColor=this.theme.userBackground,o.style.color=this.theme.userText);var s=this.convertLinksToHtml(t);return o.innerHTML=s,i.appendChild(o),i},t.prototype.createTypingMessage=function(){var t=document.createElement("li");return t.classList.add("message","message-bot","aidabot-typing"),t.innerHTML='\n    <span class="dot" style="--delay: 0.2s"></span>\n    <span class="dot" style="--delay: 0.3s"></span>\n    <span class="dot" style="--delay: 0.4s"></span>\n    ',t},t.prototype.getPostRequest=function(t){return{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}},t.prototype.initHintUI=function(t){var s=this;this._bot_ui.appendChild(this._chat_footer),this._bot_ui.style.paddingBottom="var(--aidabot-footer-height)";var a=document.createElement("div");a.classList.add("aidabot-hints-embed"),a.setAttribute("id","aidabot-hints-embed"),0<document.getElementsByClassName("message-user").length&&(a.style.display="none"),t.forEach(function(t){var e=document.createElement("div");e.classList.add("hint"),e.addEventListener("click",function(){s.sendQARequest(t.hint_content)});var n=document.createElement("p");n.classList.add("text"),n.textContent=t.hint_content,n.setAttribute("title",t.hint_content),e.appendChild(n);var i=document.createElement("span");i.classList.add("hint-icon");var o=document.createElement("span");o.classList.add("hint-icon-1"),o.innerHTML='<svg viewBox="0 0 24 24" width="20" height="20" class="inline-block"><path fill="currentColor" d="M3 20V4L22 12M5 17L16.85 12L5 7V10.5L11 12L5 13.5M5 17V7 13.5Z"></path></svg>',i.appendChild(o),e.appendChild(n),e.appendChild(i),a.appendChild(e)}),this._chat_messages.appendChild(a)},t.prototype.initBotConfig=function(s){var a,r,l,c,h;return __awaiter(this,void 0,void 0,function(){var e,n,i,o;return __generator(this,function(t){switch(t.label){case 0:e="".concat(this.base_url,"/api/channels/").concat(s,"/get-by-client-id"),t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(e,{method:"GET",headers:{"Content-Type":"application/json"}})];case 2:return[4,t.sent().json()];case 3:return n=t.sent(),(null==(i=n.data)?void 0:i.name)&&this.changeName(null==i?void 0:i.name),(null==i?void 0:i.logo)&&this.changeLogo(null==i?void 0:i.logo),this.filesLength=null==i?void 0:i.files_length,this.hints=null===(a=null==i?void 0:i.hints)||void 0===a?void 0:a.list_hints,this.greetings=null===(r=null==i?void 0:i.greetings)||void 0===r?void 0:r.list_greetings,this.settings=null==i?void 0:i.settings,this.isCollectInfo=(null===(l=this.settings)||void 0===l?void 0:l.collect_information)&&0<(null===(h=null===(c=this.settings)||void 0===c?void 0:c.collect_information_list)||void 0===h?void 0:h.length),[3,5];case 4:return o=t.sent(),console.log("error: ",o),this.scrollToBottom(),[2,[]];case 5:return[2]}})})},t.prototype.getResponse=function(i,t,o){var s=this,e="".concat(this.base_url,"/http/web-chatting"),a=document.createElement("p");""==this.chat_history_id&&(this.chat_history_id=this.uuid());var n=this.isCollectInfo?this.client_id:this.client_id+"-customer",r=localStorage.getItem(n),l={};null!==r&&(l=JSON.parse(r));var c=this.getPostRequest(__assign({source:"web-embed-chat",client_id:this.client_id,question:t},l));return this.client_id?fetch(e,c).then(function(t){t.ok&&t.json().then(function(t){var e;if(i.classList.remove("aidabot-typing"),i.innerHTML="",200===t.code){var n=s.convertLinksToHtml(t.data);a.innerHTML=n}else a.classList.add("message-error"),"ja"===s.lang?a.textContent="現在、技術的な問題が発生しており、適切な回答ができません。ご迷惑をおかけして申し訳ございませんが、時間をおいて再度お試しください。ご容赦ください。":a.textContent="We are currently experiencing technical difficulties and are unable to provide a proper response. We apologize for the inconvenience and ask that you try again later. Thank you for your patience.";i.appendChild(a),o&&s.speakText(null!==(e=a.textContent)&&void 0!==e?e:""),s.scrollToBottom()})}).catch(function(t){var e;console.log("error: ",t),i.classList.remove("aidabot-typing"),i.innerHTML="",a.classList.add("message-error"),"ja"===s.lang?a.textContent="現在、技術的な問題が発生しており、適切な回答ができません。ご迷惑をおかけして申し訳ございませんが、時間をおいて再度お試しください。ご容赦ください。":a.textContent="We are currently experiencing technical difficulties and are unable to provide a proper response. We apologize for the inconvenience and ask that you try again later. Thank you for your patience.",i.appendChild(a),o&&s.speakText(null!==(e=a.textContent)&&void 0!==e?e:""),s.scrollToBottom()}):(i.classList.remove("aidabot-typing"),i.innerHTML="",a.classList.add("message-error"),"ja"===this.lang?a.textContent="Client IDが不正です。正しいものを提出してください":a.textContent="Invalid client ID. Please provide a valid one.",i.appendChild(a),this.scrollToBottom()),i},t.prototype.scrollToBottom=function(){this._chat_messages&&this._chat_messages.scrollTo(0,this._chat_messages.scrollHeight)},t.prototype.convertLinksToHtml=function(t){t=(t=(t=(t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>")).replace(/\*(.*?)\*/g,"<em>$1</em>")).replace(/`(.*?)`/g,"<code>$1</code>")).replace(/^######\s*(.*)/g,"<h6>$1</h6>").replace(/^#####\s*(.*)/g,"<h5>$1</h5>").replace(/^####\s*(.*)/g,"<h4>$1</h4>").replace(/^###\s*(.*)/g,"<h3>$1</h3>").replace(/^##\s*(.*)/g,"<h2>$1</h2>").replace(/^#\s*(.*)/g,"<h1>$1</h1>");var e=/\[([^\]]+)\]\((https?:\/\/[^\s]+)\)/g,n=/(https?:\/\/[^\s]+)/g;return e.test(t)?t.replace(e,'<a href="$2" target="_blank">$1</a>'):n.test(t)?t.replace(n,'<a href="$1" target="_blank">$1</a>'):t},t.prototype.getElementCollectInformation=function(){var t,e=this,n={en:{title:"Please give us your information to support you better",name:"Your Name",namePlaceholder:"Type your name",email:"Email address",emailPlaceholder:"Type email address",phone_number:"Phone number",phone_numberPlaceholder:"Type phone number",button:"Let’s chat!"},ja:{title:"より良いサポートを提供するために、あなたの情報を教えてください",name:"名前",namePlaceholder:"名前を入力してください",email:"メールアドレス",emailPlaceholder:"メールアドレスを入力してください",phone_number:"電話番号",phone_numberPlaceholder:"電話番号を入力してください",button:"話しましょう！"},vi:{title:"Vui lòng cung cấp thông tin của bạn để chúng tôi hỗ trợ bạn tốt hơn",name:"Tên",namePlaceholder:"Nhập tên",email:"Email",emailPlaceholder:"Nhập email",phone_number:"Số điện thoại",phone_numberPlaceholder:"Nhập số điện thoại",button:"Bắt đầu!"}},i='<form id="collectInfo" class="collect-info">\n        <div class="collect-title">'.concat(n[this.lang].title,'</div>\n        <div class="collect-form">');return null===(t=this.settings)||void 0===t||t.collect_information_list.forEach(function(t){i+='<div class="collect-field">\n            <label for="#'.concat(t,'">').concat(n[e.lang][t],' *</label>\n            <div class="collect-input">\n              <input id="').concat(t,'" type="text" placeholder="').concat(n[e.lang][t+"Placeholder"],'" name="').concat(t,'" value="">\n              <span class="error"></span>\n            </div>\n          </div>')}),i+='</div>\n        <button type="submit" class="submit-collect-info-btn">'.concat(n[this.lang].button,"</button>\n      </form>")},t.prototype.validateForm=function(r){var t=this,l={en:{nameRequired:"Please enter your name",emailRequired:"Please enter email address",phone_numberRequired:"Please enter phone number",invalidEmail:"This must be a valid email",invalidPhone:"This must be a phone number"},ja:{nameRequired:"名前をご入力ください。",emailRequired:"メールアドレスをご入力ください。",phone_numberRequired:"電話番号をご入力ください。",invalidEmail:"これは有効なメールでなければなりません。",invalidPhone:"これは電話番号でなければなりません"},vi:{nameRequired:"Vui lòng nhập tên",emailRequired:"Vui lòng nhập email",phone_numberRequired:"Vui lòng nhập số điện thoại",invalidEmail:"Vui lòng nhập đúng địa chỉ email",invalidPhone:"Vui lòng nhập đúng số điện thoại"}},c=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,h=/^(\+?\d{0,4})?\s?-?\s?(\(?\d{3}\)?)\s?-?\s?(\(?\d{3}\)?)\s?-?\s?(\(?\d{4}\)?)?$/,d=document.querySelector("#collectInfo");d&&d.addEventListener("submit",function(a){return __awaiter(t,void 0,void 0,function(){var o,e,n,i,s=this;return __generator(this,function(t){return a.preventDefault(),o=!0,null===(i=this.settings)||void 0===i||i.collect_information_list.forEach(function(t){var e=d.querySelector("#"+t),n=null==e?void 0:e.closest(".collect-input");if(e&&n){var i=n.querySelector(".error");if(i){if(!e.value.trim())return i.textContent=l[s.lang][t+"Required"],void(o=!1);if("email"===t&&!c.test(e.value.trim()))return i.textContent=l[s.lang].invalidEmail,void(o=!1);if("phone_number"===t&&!h.test(e.value.trim()))return i.textContent=l[s.lang].invalidPhone,void(o=!1);i.textContent=null}}}),o&&(r.remove(),e=this.createTypingMessage(),this._chat_messages.appendChild(e),(n=new FormData(d)).append("source","qr-chat"),fetch("".concat(this.base_url,"/api/channels/").concat(this.client_id,"/get-customers-by-client-id"),{method:"POST",body:n}).then(function(t){return t.json()}).then(function(t){if(200===t.status)return localStorage.setItem(s.client_id,JSON.stringify(t.data)),e.remove(),void s.initHintUI(s.hints);throw new Error("error")}).catch(function(t){e.classList.remove("typing"),e.classList.add("message-error"),"ja"===s.lang?e.textContent="現在、技術的な問題が発生しており、適切な回答ができません。ご迷惑をおかけして申し訳ございませんが、時間をおいて再度お試しください。ご容赦ください。":"vi"===s.lang?e.textContent="'Chúng tôi hiện đang gặp khó khăn về kỹ thuật và không thể đưa ra phản hồi thích hợp. Chúng tôi xin lỗi vì sự bất tiện này và yêu cầu bạn thử lại sau. Cảm ơn vì sự kiên nhẫn của bạn.'":e.textContent="We are currently experiencing technical difficulties and are unable to provide a proper response. We apologize for the inconvenience and ask that you try again later. Thank you for your patience.",s.scrollToBottom()})),[2]})})})},t.prototype.initVoiceRecognition=function(){var t,n=this,e=window.SpeechRecognition||window.webkitSpeechRecognition;e?(this.recognition=new e,this.recognition.continuous=!0,this.recognition.interimResults=!0,this.recognition.lang="ja"===this.lang?"ja-JP":"vi"===this.lang?"vi-VN":"en-US",this.recognition.onresult=function(t){clearTimeout(n.sendMessageTimeout);for(var e=t.resultIndex;e<t.results.length;e++)n.isListening&&(n._input.value=t.results[e][0].transcript,n._input.style.height="",n._input.style.height=Math.min(n._input.scrollHeight,121)+"px");n.sendMessageTimeout=setTimeout(function(){n.isListening&&(n.stopRecognition(),n.sendQA(),n._input.value="")},3e3)},this.recognition.onspeechend=function(){clearTimeout(n.sendMessageTimeout),n.sendMessageTimeout=setTimeout(function(){n.isListening&&(n.stopRecognition(),n.sendQA(),n._input.value="")},3e3)},this.recognition.onend=function(){n.isListening=!1,n.updateVoiceButton()},this.recognition.onerror=function(t){console.error("Error occurred in recognition: "+t.error)},null===(t=document.getElementById("btn-voice"))||void 0===t||t.addEventListener("click",function(){n.isListening?n.stopRecognition():n.startRecognition()})):console.error("Web Speech API not supported")},t.prototype.handleRecognition=function(){this.isSpeaking?(speechSynthesis.cancel(),this.isSpeaking=!1,this.updateVoiceButton()):this.isListening?this.stopRecognition():this.startRecognition()},t.prototype.startRecognition=function(){this.recognition&&(this.recognition.start(),this.isListening=!0,this.updateVoiceButton())},t.prototype.stopRecognition=function(){this.recognition&&(this.recognition.stop(),0<this._input.value.trim().length&&this._send_btn.click(),this.updateVoiceButton(),this.isListening=!1)},t.prototype.updateVoiceButton=function(){this.isListening?this._voice_btn.innerHTML=this.svgMicOnIcon():this._voice_btn.innerHTML=this.svgMicIcon()},t.prototype.filterMessage=function(t,e){var n={en:{web:"website address",email:"email address"},vi:{web:"địa chỉ web",email:"địa chỉ email"},ja:{web:"ウェブサイトアドレス",email:"メールアドレス"}},i=n[e]||n.en,o=i.web,s=i.email;return t.replace(/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,o).replace(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,s)},t.prototype.loadVoices=function(){var n=this;return new Promise(function(e){var t=window.speechSynthesis.getVoices();0!==t.length?(n.voicesLoaded=!0,e(t)):window.speechSynthesis.onvoiceschanged=function(){var t=window.speechSynthesis.getVoices();n.voicesLoaded=!0,e(t)}})},t.prototype.speakText=function(s){return __awaiter(this,void 0,void 0,function(){var e,n,i,o;return __generator(this,function(t){switch(t.label){case 0:return e=[],this.voicesLoaded?[3,2]:[4,this.loadVoices()];case 1:e=t.sent(),t.label=2;case 2:return e=window.speechSynthesis.getVoices(),n="ja"===lang?"ja-JP":"vi"===lang?"vi-VN":"en-US",i=e.find(function(t){return t.lang===n}),o=new SpeechSynthesisUtterance(this.filterMessage(s,lang)),void 0!==i&&(o.voice=i),o.rate="vi"===lang?1.2:1,o.pitch="vi"===lang?.8:1,o.onend=function(){isSpeaking=!1;var t=document.querySelector(".stop-btn"),e=document.querySelector(".read-btn");t&&(t.style.display="none",null!==e&&(e.style.display="flex"))},speechSynthesis.speak(o),isSpeaking=!0,[2]}})})},t}(),isSpeaking=!1,lang="vi";function showReadOption(t,e){var n=new Aidabot,i={en:{copy:"Copy text",readMessage:"Speak message",stopRead:"Stop speaking message"},ja:{copy:"コピー",readMessage:"メッセージを読む",stopRead:"読むのをやめる"},vi:{copy:"Sao chép",readMessage:"Đọc tin nhắn",stopRead:"Dừng đọc"}},o=document.querySelector(".read-option");o&&o.remove();var s=document.createElement("div");s.classList.add("read-option");var a=document.createElement("div");a.classList.add("copy-btn","fade-in"),a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><g id="stop-icon"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1z" fill="#007bff"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0z" fill="#007bff"/></g><span id="copy">'.concat(i[lang].copy,"</span></svg>");var r=document.createElement("div");r.classList.add("read-btn","fade-in"),r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-volume-up" viewBox="0 0 16 16"><g id="read-icon"><path d="M11.536 14.01A8.47 8.47 0 0 0 14.026 8a8.47 8.47 0 0 0-2.49-6.01l-.708.707A7.48 7.48 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303z" fill="#007bff"/><path d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.48 5.48 0 0 1 11.025 8a5.48 5.48 0 0 1-1.61 3.89z" fill="#007bff"/><path d="M10.025 8a4.5 4.5 0 0 1-1.318 3.182L8 10.475A3.5 3.5 0 0 0 9.025 8c0-.966-.392-1.841-1.025-2.475l.707-.707A4.5 4.5 0 0 1 10.025 8" fill="#007bff"/><path d="M7 4a.5.5 0 0 0-.812-.39L3.825 5.5H1.5A.5.5 0 0 0 1 6v4a.5.5 0 0 0 .5.5h2.325l2.363 1.89A.5.5 0 0 0 7 12zM4.312 6.39 6 5.04v5.92L4.312 9.61A.5.5 0 0 0 4 9.5H2v-3h2a.5.5 0 0 0 .312-.11" fill="#007bff"/></g><span id="read-message">'.concat(i[lang].readMessage,"</span></svg>");var l=document.createElement("div");l.classList.add("stop-btn","fade-in"),l.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-volume-mute" viewBox="0 0 16 16"><g id="stop-icon"><path d="M6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 0 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06" fill="#dc3545"/><path d="M6 5.04 4.312 6.39A.5.5 0 0 1 4 6.5H2v3h2a.5.5 0 0 1 .312-.11L6 10.96zm7.854.606a.5.5 0 0 1 0 .708L12.207 8l1.647 1.646a.5.5 0 0 1-.708.708L11.5 8.707l-1.646 1.647a.5.5 0 0 1-.708-.708L10.793 8 9.146 6.354a.5.5 0 1 1 .708-.708L11.5 7.293l1.646-1.647a.5.5 0 0 1 .708 0" fill="#dc3545"/></g><span id="stop-read">'.concat(i[lang].stopRead,"</span></svg>"),isSpeaking?r.style.display="none":l.style.display="none";var c=t.target.getBoundingClientRect(),h="rgb(255, 255, 255)"===window.getComputedStyle(t.target).color;s.style.position="absolute",s.style.top="".concat(c.bottom+window.scrollY,"px"),h?s.style.right="".concat(window.innerWidth-c.right,"px"):s.style.left="".concat(c.left+window.scrollX,"px"),a.addEventListener("click",function(){navigator.clipboard.writeText(e).then(function(){a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="green" class="bi bi-check" viewBox="0 0 16 16"><path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-4.5 4.5a.75.75 0 0 1-1.08 0l-2.5-2.5a.75.75 0 1 1 1.08-1.05l2.2 2.2 4.23-4.2z"/></svg><span id="copy">'.concat(i[lang].copy,"</span>")}).catch(function(t){console.error("Can't copy text",t)})}),r.addEventListener("click",function(){n.speakText(e),r.style.display="none",l.style.display="flex"}),l.addEventListener("click",function(){speechSynthesis.cancel(),isSpeaking=!1,l.style.display="none",r.style.display="flex"}),s.appendChild(a),s.appendChild(r),s.appendChild(l),document.body.appendChild(s)}document.body.addEventListener("mousedown",function(t){var e,n,i,o=null===(e=t.target)||void 0===e?void 0:e.closest(".message-bot"),s=null===(n=t.target)||void 0===n?void 0:n.closest(".message-user"),a=null===(i=t.target)||void 0===i?void 0:i.closest(".collect-info"),r=document.querySelector(".read-option");if(r&&(r.contains(t.target)||r.remove()),(o||s)&&!a){var l=o||s;t.preventDefault();var c=setTimeout(function(){showReadOption(t,(null==l?void 0:l.textContent)||"")},500);l&&(l.addEventListener("mouseup",function(){clearTimeout(c)}),l.addEventListener("mouseleave",function(){clearTimeout(c)}))}}),document.body.addEventListener("touchstart",function(t){var e,n,i,o=null===(e=t.target)||void 0===e?void 0:e.closest(".message-bot"),s=null===(n=t.target)||void 0===n?void 0:n.closest(".message-user"),a=null===(i=t.target)||void 0===i?void 0:i.closest(".collect-info"),r=document.querySelector(".read-option");if(r&&(r.contains(t.target)||r.remove()),(o||s)&&!a){var l=o||s;t.preventDefault();var c=setTimeout(function(){showReadOption(t,(null==l?void 0:l.textContent)||"")},500);l&&(l.addEventListener("touchend",function(){clearTimeout(c)}),l.addEventListener("touchcancel",function(){clearTimeout(c)}))}});var scriptTag=document.querySelector("script[data-client-id]");if(null==scriptTag?void 0:scriptTag.dataset.clientId){var botConfig={clientId:scriptTag.dataset.clientId},botChat=new Aidabot,linkCss=document.createElement("link");linkCss.rel="stylesheet",linkCss.href="".concat(botChat.getAssetsUrl(),"/aidabot.min.css"),document.head.appendChild(linkCss),botChat.setConfig(botConfig),botChat.init()}